/**
 * Created by fujinliang on 15/3/16.
 */
var sys_activityID = "";
var sys_config = "";
var game_logo = "";
var game_id = "";

var share_title = "";
var share_message = "";
var share_image = "";
var share_href = location.href;

var guide_btn = "更多游戏";
var guide_href = "http://mp.weixin.qq.com/s?__biz=MzA5NzQxMzU4NQ==&mid=207293871&idx=1&sn=173662dd6d0b62ec9f19382a5368f270#rd";
var is_prize = "";
var sys_is_weixin = false;
var game_max_score = 100;

var oldTitle = "微伞游戏";
var openid = null;

function is_weixn(){
    var ua = navigator.userAgent.toLowerCase();
    if(ua.match(/MicroMessenger/i)== "micromessenger") {
        sys_is_weixin = true;
    }

    var url=document.URL;
    var config_info = "";
    var para="";
    if(url.lastIndexOf("?")>0) {
        para = url.substring(url.lastIndexOf("?") + 1, url.length);
        var arr = para.split("&");
        if(arr[0].split("=")[0] == "activityID"){
            sys_activityID = arr[0].split("=")[1];
        }else{
            if (arr[0].split("=")[0] == "gameID") {
                game_id = arr[0].split("=")[1];
            };
            if(arr.length >=2){
                if(arr[1].split("=")[0] == "sign"){
                    openid = arr[1].split("=")[1];
                }
            }

            if(openid == null && sys_is_weixin){
                //location.href = "http://www.wesane.com/admin.php/Gameshow/getUserOpenid/gameId/"+game_id;
            }
            document.getElementById("logoImg").style.display = "block";
            (adsbygoogle = window.adsbygoogle || []).push({});
        }

    }else{
        (adsbygoogle = window.adsbygoogle || []).push({});
    }

}

is_weixn();


function gamelogo_load(){
    ajaxLoad("http://www.wesane.com/admin.php/Activityshow/gamelogo","activityId="+sys_activityID+"&gameID="+game_id, ajaxOnLogoResult);

}


function ajaxLoad(uri,postData, callback) {
    var request = (window.XMLHttpRequest) ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP");
    request.onreadystatechange = callback;
    request.open("POST", uri);
    request.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    request.send(postData);
}

function ajaxOnLogoResult(evt) {
    if ((evt.currentTarget.readyState == 4) && (evt.currentTarget.status == 200 || evt.currentTarget.status == 0)) {

        var sys_config = JSON.parse(evt.currentTarget.responseText);
        game_logo = sys_config["logo_url"];
        guide_btn = sys_config["activity_btn"];
        guide_href = sys_config["activity_btnlink"];
        is_prize = sys_config["is_prize"];
        game_max_score = sys_config["max_score"];
        if(game_logo){
            game_logo = "http://www.wesane.com/Public/"+game_logo;
        }
    }
}

function score_submit(gameScore,gameType){
    ajaxLoad("http://www.wesane.com/admin.php/Gamescore/saveGamescore","gameScore="+gameScore+"&gameId="+game_id+"&gameType="+gameType, scoreResult);
}

function scoreResult(){

}


function score_share(score_title){
    oldTitle = document.title;
    document.title = score_title;
}

function initTitle(){
    //document.title = oldTitle;
}

gamelogo_load();
